<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>在线书店 - 首页</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <style>
        .book-card-img {
            height: 280px;
            object-fit: contain;
            background: #f8f9fa;
            padding: 10px;
        }
        .card-title {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold fs-4" href="{{ url_for('index') }}">在线书店</a>
            
            <!-- 搜索栏 -->
            <form class="d-flex flex-grow-1 mx-lg-5 my-2 my-lg-0" action="{{ url_for('search') }}">
                <input class="form-control me-2" type="search" name="q" placeholder="搜索书名、ISBN、出版社..." aria-label="搜索">
                <button class="btn btn-light" type="submit">搜索</button>
            </form>

            <!-- 用户菜单 -->
            <div class="d-flex align-items-center">
                {% if session.user_id %}
                    <a href="/cart" class="btn btn-outline-light me-2">
                        <i class="bi bi-cart"></i> 购物车
                    </a>
                    <a href="/orders" class="btn btn-outline-light me-2">我的订单</a>
                    <div class="dropdown">
                        <a class="btn btn-outline-light dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            {{ session.username }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/profile">个人中心</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">退出登录</a></li>
                        </ul>
                    </div>
                {% else %}
                    <a href="{{ url_for('login') }}" class="btn btn-outline-light me-2">登录</a>
                    <a href="{{ url_for('register') }}" class="btn btn-light">注册</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <div class="container my-5">
        <div class="row">
            <!-- 左侧分类导航 -->
            <div class="col-lg-3 mb-4">
                <h5 class="fw-bold mb-3">图书分类</h5>
                <div class="list-group">
                    <a href="{{ url_for('search') }}" class="list-group-item list-group-item-action {% if not request.args.get('category') %}active{% endif %}">
                        全部图书
                    </a>
                    {% for cat in categories %}
                        <a href="{{ url_for('search', category=cat.category_id) }}" 
                           class="list-group-item list-group-item-action">
                            {{ cat.category_name }}
                        </a>
                    {% endfor %}
                </div>
            </div>

            <!-- 右侧热销推荐 -->
            <div class="col-lg-9">
                <h4 class="fw-bold mb-4">热销推荐</h4>

                {% if hot_books|length == 0 %}
                    <div class="text-center py-5 text-muted">
                        <p>暂无书籍数据，请先添加一些图书~</p>
                    </div>
                {% else %}
                    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4">
                        {% for book in hot_books %}
                        <div class="col">
                            <div class="card h-100 shadow-sm hover-shadow transition">
                                <!-- 封面图 -->
                                {% if book.cover_url %}
                                    <img src="{{ book.cover_url }}" 
                                         class="card-img-top book-card-img"
                                         alt="{{ book.title }}"
                                         onerror="this.src='{{ url_for('static', filename='default-cover.jpg') }}'; this.onerror=null;">
                                {% else %}
                                    <img src="{{ url_for('static', filename='default-cover.jpg') }}" 
                                         class="card-img-top book-card-img" 
                                         alt="默认封面">
                                {% endif %}

                                <div class="card-body d-flex flex-column">
                                    <h6 class="card-title fw-bold">{{ book.title }}</h6>
                                    
                                    {% if book.publisher %}
                                        <p class="text-muted small mb-1">{{ book.publisher }}</p>
                                    {% endif %}

                                    <div class="d-flex align-items-center mb-2">
                                        <span class="text-danger fw-bold fs-5">¥{{ "%.2f"|format(book.price) }}</span>
                                        {% if book.rating and book.rating > 0 %}
                                            <small class="text-warning ms-auto">
                                                ★ {{ book.rating }}/5.0
                                            </small>
                                        {% endif %}
                                    </div>

                                    <div class="mt-auto">
                                        <a href="{{ url_for('book_detail', book_id=book.book_id) }}" 
                                           class="btn btn-primary btn-sm w-100">
                                            查看详情
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-4 mt-5 border-top">
        <div class="container text-center text-muted">
            © 2025 在线书店 | 基于 Flask + SQL Server 开发
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bootstrap Icons（可选，用于购物车图标等） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</body>
</html>